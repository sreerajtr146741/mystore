# Render Deployment Guide for MyStore

## üöÄ What Was Fixed

### Critical Issues Resolved:
1. ‚úÖ **Missing .htaccess file** - Added Laravel's URL rewriting configuration
2. ‚úÖ **Dockerfile migration timing** - Moved migrations to entrypoint script (runs at startup, not build)
3. ‚úÖ **Apache ServerName warning** - Configured ServerName to suppress warnings
4. ‚úÖ **PORT environment variable** - Fixed Apache to properly use Render's dynamic PORT
5. ‚úÖ **render.yaml configuration** - Changed from `env: php` to `env: docker`
6. ‚úÖ **Mail configuration** - Added SMTP environment variables

## üìã Deployment Steps

### 1. Push Your Code to GitHub/GitLab
```bash
git push origin main
```

### 2. Create a Render Account
- Go to https://render.com
- Sign up or log in

### 3. Create a New Web Service
1. Click **"New +"** ‚Üí **"Blueprint"**
2. Connect your GitHub/GitLab repository
3. Render will auto-detect `render.yaml`
4. Click **"Apply"**

### 4. Configure Environment Variables
In the Render Dashboard, go to **Environment** tab and set:

#### Required Database Variables:
- `DB_HOST` - Your MySQL host (e.g., from Render MySQL or external)
- `DB_DATABASE` - Your database name
- `DB_USERNAME` - Database username
- `DB_PASSWORD` - Database password

#### Required Mail Variables (if using Gmail):
- `MAIL_USERNAME` - Your Gmail address
- `MAIL_PASSWORD` - Your Gmail App Password
- `MAIL_FROM_ADDRESS` - Your Gmail address

#### Auto-Generated (already configured):
- `APP_KEY` - Auto-generated by Render
- `APP_URL` - Set to your Render URL (e.g., https://buyorix-backend.onrender.com)

### 5. Create a MySQL Database (if needed)
1. In Render Dashboard, click **"New +"** ‚Üí **"PostgreSQL"** or use external MySQL
2. For MySQL, you might need to use an external service like:
   - PlanetScale (free tier)
   - Railway
   - AWS RDS Free Tier

### 6. Deploy
- Render will automatically build and deploy
- First deployment takes 5-10 minutes
- Watch the logs for any errors

## üîç Troubleshooting

### If you see HTTP 500 errors:
1. Check Render logs for specific error messages
2. Verify all environment variables are set correctly
3. Ensure database connection is working
4. Check that `APP_KEY` is generated

### Common Issues:

#### "No application encryption key has been specified"
- Make sure `APP_KEY` is set in environment variables
- The entrypoint script will auto-generate it if missing

#### Database connection errors
- Verify `DB_HOST`, `DB_DATABASE`, `DB_USERNAME`, `DB_PASSWORD`
- Ensure your database allows connections from Render's IP

#### "Class not found" errors
- This usually means composer dependencies didn't install
- Check build logs for composer errors

## üìù What Happens During Deployment

### Build Phase (Dockerfile):
1. Installs PHP 8.2 with Apache
2. Installs system dependencies (Node.js, Git, etc.)
3. Installs PHP extensions (MySQL, GD, etc.)
4. Copies your application code
5. Runs `composer install --no-dev --optimize-autoloader`
6. Runs `npm install && npm run build`
7. Sets proper file permissions

### Startup Phase (Entrypoint Script):
1. Generates `APP_KEY` if not set
2. Caches configuration, routes, and views
3. Runs database migrations (`php artisan migrate --force`)
4. Starts Apache server

## üåê Your Application URLs

- **Main URL**: https://buyorix-backend.onrender.com
- **API Endpoints**: https://buyorix-backend.onrender.com/api/*
- **Admin Panel**: https://buyorix-backend.onrender.com/admin/*

## ‚öôÔ∏è Environment Variables Reference

```env
# App Configuration
APP_NAME=MyStore
APP_ENV=production
APP_DEBUG=false
APP_URL=https://buyorix-backend.onrender.com
APP_KEY=base64:... (auto-generated)

# Database
DB_CONNECTION=mysql
DB_HOST=your-db-host
DB_PORT=3306
DB_DATABASE=your-db-name
DB_USERNAME=your-db-user
DB_PASSWORD=your-db-password

# Mail (Gmail SMTP)
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=your-email@gmail.com
MAIL_FROM_NAME=MyStore
```

## üîÑ Redeploying

After making code changes:
```bash
git add .
git commit -m "Your commit message"
git push origin main
```

Render will automatically detect the push and redeploy.

## üìä Monitoring

- **Logs**: Available in Render Dashboard ‚Üí Logs tab
- **Metrics**: Check CPU, Memory usage in Dashboard
- **Health Checks**: Render automatically pings your app

## üÜò Support

If deployment fails:
1. Check the build logs in Render Dashboard
2. Verify all environment variables
3. Test database connection
4. Review Laravel logs (will appear in Render logs)

---

**Last Updated**: January 6, 2026
**Status**: Ready for deployment ‚úÖ
